<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
	<channel>
		<title>ComplexCity Lab's Blog</title>
		<link>http://complexcity.org/blog/</link>
		<description>A Comprehensive Blog on Smart and Social City</description>
	

		<item>
			<title>Tianzifang: Community or Tourism?</title>
			<link>http://complexcity.org/blog//2014/06/16/tianzifang-community-or-tourism.html</link>
			<guid isPermaLink="true">http://complexcity.org/blog//2014/06/16/tianzifang-community-or-tourism.html</guid>
			<pubDate>2014-06-16T00:00:00+08:00</pubDate>
			<description>&lt;p&gt;Tianzifang (田子坊) is an arts and crafts enclave that has developed from a renovated residential area in Shanghai, China. It is known for small craft stores, coffee shops, art studios and narrow alleys. “Despite all the businesses selling trendy foreign goods, the area does not have the look of having been overly beautified — electricity cables are still strung overhead, and air conditioning units are obvious on the outside of the buildings. The district is distinctly different from Xintiandi, another Shikumen redevelopment in the vicinity to the north, in that it has managed to preserve its residential feel, adding to its appeal.”[&lt;a href=&quot;#1&quot;&gt;1&lt;/a&gt;] However, to preserve this “residential feel”, conflicts among local residents, developers, shop owners, and tourists are getting increasingly intense, which brought us an inevitable question: how to preserve a declining area and balance healthy community and economic-beneficial tourism in a win-win solution?&lt;/p&gt;

&lt;h2 id=&quot;conflicts_between_stakeholders_interests&quot;&gt;Conflicts Between Stakeholders’ Interests&lt;/h2&gt;

&lt;p&gt;Tianzifang provides an invaluable opportunity for pouring visitors to engage multiple activities, such as relaxing, shopping, people-watching, and more importantly, to experience authentic Shanghai life and fully contact with &lt;a href=&quot;http://en.wikipedia.org/wiki/Longtang&quot;&gt;lilong&lt;/a&gt; culture. Besides, all the foreign goods, exotic restaurants, cafe, and bars well represent the openness of Shanghai, and the city’s willing to embrace people all around the world. It is strongly appreciated by both Chinese and international visitors.The government and developers (Administrative Committee of Taikanglu Art Street, Shikumen Owners Management Committee (NGO), and artists) emphasize on how to effectively avoid the problems of Xintiandi development mode, which is often criticized as “fake” by tourists, for its lack of residential atmosphere caused by relocation of original communities. From Tianzifang renovation project, we can see developers’ effort to uplift local economy while create a mixed-function community and inclusive society, and it is undoubtedly praisable. Moreover, this innovative mode is more appealing to tourists who look forward to experiencing the “good old Shanghai life”. Meanwhile, it preserves the traditional Shikumen buildings and Shanghai’s lilong (里弄) culture. A relatively large proportion of senior citizens are living in Tianzifang, and they would rather stay than move to new places. But many of them stick to a routine lifestyle, wake up around 4 am and go to sleep around 8 pm. And these elderly residents don’t appreciate much to see their rest time overlaped by the party time of the young generation who come to enjoy a modern nightlife between 9 pm and 3 am! This sort of conflict is not only reflected in Tianzifang though, but in other places where recreation facilities — bars, cafe — are mixed with residential areas, such as Yongkang Rd., etc. To vent their discontent, the local residents call the police to complain about the noise or other infringements caused by the visitors, hang posters or slogans in Tianzifang:&lt;/p&gt;
&lt;div class=&#39;clearfix&#39; style=&#39;margin-bottom:1em; &#39;&gt;
&lt;img alt=&#39;My helpful screenshot&#39; class=&#39;post-img&#39; src=&#39;/assets/tianzifang-community-or-tourism/poster.jpg&#39; /&gt;
&lt;p&gt;坚决反对民宿，我们要活命、要生存&lt;br /&gt;We are firmly against boarding house (bed and breakfast), that we need to live and survive.&lt;/p&gt;
&lt;p&gt;坚决禁止噪声扰民，还我一个安静安全的环境&lt;br /&gt;We are firmly against noise nuisance. Give me back my quiet and safe environment!&lt;/p&gt;
&lt;p&gt;强烈要求政府实施晚10时商家停止营业&lt;br /&gt;We strongly demand that the government enforce all shops close business at 10pm.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;However, the problem is more complex than at first sight. To some extent, this innovative renovation project indeed excludes some residents’ expectations for achieving certain benefits from a typical gentrification process, such as a large-scale redevelopment project. Compared with large-scale redevelopment and relocation projects in other parts of Shanghai, it is understandable that local residents are easier to feel injustice and despair of the fact that, after the renovation of Tianzifang, there is barely chance for them to obtain large amounts of relocation compensation like others to move to new-built apartments. This may look quite surprising, considering for example, that in France or other western countries, inhabitants are delighted to see renovation of their communities while they can still keep their everyday life there. Similarly, in Japan, inhabitants tend to put preservation of culture heritage above their own interests. Nonetheless, Chinese residents, especially those who live in old communities with low-income, value more their own benefits. In short, regeneration of Tianzifang deprives the expectation/opportunities of inhabitants for relocation and the following economic profits.&lt;/p&gt;

&lt;h2 id=&quot;answer_arts_rejuvenation__etourism&quot;&gt;Answer: Arts Rejuvenation + E-tourism&lt;/h2&gt;

&lt;h3 id=&quot;arts_rejuvenation&quot;&gt;Arts Rejuvenation&lt;/h3&gt;

&lt;p&gt;Tianzifang was named after a famous painter in China’s foundational texts of Daoism “Zhuangzi”, Chapter 21 “Tianzifang”2 (See &lt;a href=&quot;#appendix&quot;&gt;Appendix&lt;/a&gt;). At the beginning, the renovation of Tianzifang was initiated by a group of famous artists who moved into some simply renovated factory space as their art studios with the intention to rejuvenate the dilapidated community and to make the place better known. Then, an expansion into the residential area progressed beyond factory boundaries, and spaces for creative industry gradually grew into smaller alleys. The architect Hiroyuki Shinohara explains [&lt;a href=&quot;#3&quot;&gt;3&lt;/a&gt;]:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;With the expansion, the artistic atmosphere infiltrated into the Shikumen residential area and changed pure residential characters. The artists and designers settled renovated old houses by themselves and updated the function of the buildings. Interior spaces have been converted into unique spaces for creativity industry, and newly added signs and door fittings on façade interplay with old building structures underlain, and narrow old allays are visually animated.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;However, the continuing expansion of non-residential use were extended to more commercial ones such as coffee shops, bars, restaurants, retails. On one hand, this brought considerable economic benefits by attracting thousands of tourists per day; on the other hand, it deteriorated the conflicts between inhabitants and visitors, and went far against its intention as a creative industry accumulated district of Shanghai.&lt;/p&gt;

&lt;p&gt;American cities are also actively engaging arts into community revival. For instance, through cultural organization and engagement-based arts programming, the Big Car Project brings together people of all backgrounds in local Indiana communities to inspire creativity and activate public spaces. It collaborates with local residents and stakeholders by forming partnerships in order to build social capital and encourage civically engaged communities. Big Car utilizes the unique “social practice art,” i.e., individuals that may not necessarily define themselves as artists become directly involved in the process of art, building connections and empathy among participants [&lt;a href=&quot;#4&quot;&gt;4&lt;/a&gt;].&lt;/p&gt;

&lt;p&gt;According to the inspiring practice of the Big Car Project and the retrospection of the growing history of Tianzifang, it may be more suitable for the future sustainable development of the area to encourage in-depth public participation into art activities, pursue creative solutions to attract and gather artists, and utilize art and artists to engage residents in a creative dialogue, instead of further turning the area into a tourism-oriented commercial street. It is time to bridge the gap between art institutions and residents, in a word, not just “bring art to people”, but also “bring people to art”.&lt;/p&gt;

&lt;h3 id=&quot;etourism&quot;&gt;E-tourism&lt;/h3&gt;

&lt;p&gt;As French Secretary of State for Foreign Trade, Fleur Pellerin pointed out, “the development of digital technology and mobility constitutes a major change in the tourist experience.”[&lt;a href=&quot;#5&quot;&gt;5&lt;/a&gt;], ComplexCity Lab is willing to make Tianzifang a successful sample in terms of “e-tourism” by taking full advantage of the available public data and serving for all participants. We are capable of managing data to optimize the attractiveness of Tianzifang and making better use of its “cultural and creative capital”. The methodology is, implementing a community-wide solution (such as Tianzifang) and use it as a standard benchmark for further promotion. Specific applicable solutions include, from the experience applied in Paris, recycling the heat generated by shops, restaurants, and art studios as a byproduct for heating and supplying electricity for all residential buildings. With the extensive use of smart phone, all shops will receive text messages to remind them keep voice down after 10 pm. With the help of geographic-tracking apps, when tourists approach residential area, they will get text messages to remind them of the fact that people are living there, thus, they may need to change their behavior. Building digital map of Tianzifang with the option of picking up purchases at the tourists’ preference stores or studios, to best avoid the trespass of residential area.&lt;/p&gt;

&lt;h2 id=&quot;appendix&quot;&gt;&lt;a name=&#39;appendix&#39; /&gt;Appendix&lt;/h2&gt;

&lt;p&gt;Legend of “Tianzifang”: Yuan King of Song (531–517 BC) asked for paintings, so all the painters arrived to the palace. They stood aside after kowtowed and made their bow. After, they wet their painting brush and prepared the ink. However, half of them were laymen. There was one painter arrived late. He looked leisurely, and didn’t follow the royal rite to walk fast. He politely bowed but didn’t stand up, instead, he returned home immediately. The King sent the herald to check up on him, and found that he took off his coat, sat down with his legs crossed, lifted his sleeves, and was holding his painting brush. “Yes, he is the true great painter” said the King. (宋元君将画图，众史皆至，受揖而立，舐笔和墨，在外者半。有一史后至者，譠譠然不趋，受揖不立，因之舍。公使人视之，则解衣盘礴，裸袖握管。君曰：“可矣，是真画者也。” )&lt;/p&gt;

&lt;h2 id=&quot;bibliography&quot;&gt;Bibliography&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a name=&#39;1&#39; /&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Tianzifang&quot;&gt;Tianzifang&lt;/a&gt;, Wikipedia.&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Zhuangzi_\(book\&quot;&gt;Zhuangzi (庄子)&lt;/a&gt;), Wikipedia.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;3&#39; /&gt;Shinohara, Hiroyuki. “Mutation of Tianzifang, Taikang Road, Shanghai”. The 4th Conference of the &lt;a href=&quot;http://newurbanquestion.ifou.org/proceedings/5%20The%20Transformation%20of%20Urban%20Form/poster%20papers/D039_Hiroyuki_Shinohara_Mutation%20of%20Tianzifang.pdf&quot;&gt;International Forum on Urbanism&lt;/a&gt;, Amsterdam/Delft, (2009): pp. 749-752.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;4&#39; /&gt;Chilingerian, Jenna. “Engagement Through Arts”. &lt;a href=&quot;http://www.ceosforcities.org/blog/engagement-through-arts/&quot;&gt;CEOs for Cities&lt;/a&gt;, August 21, 2013.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;5&#39; /&gt;Pellerin, Fleur, “France must become the world standard for e-tourism”, &lt;a href=&quot;http://issuu.com/omegaconseil/docs/adp_paris_world_wide&quot;&gt;Paris Worldwide&lt;/a&gt;, (May/June 2014): pp. 68-72.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Photo: &lt;a href=&quot;http://www.flickr.com/photos/birgerhoppe/4729645791&quot;&gt;TianZiFang II&lt;/a&gt; by &lt;a href=&quot;https://www.flickr.com/photos/birgerhoppe/&quot;&gt;Birger Hoppe&lt;/a&gt; , licensed under &lt;a href=&quot;https://creativecommons.org/licenses/by-nc-nd/2.0/&quot;&gt;CC BY-NC-ND 2.0&lt;/a&gt;&lt;/p&gt;</description>
		</item>
	
	

		<item>
			<title>Weido spatial and temporal data explained</title>
			<link>http://complexcity.org/blog//2014/06/02/weibo-spatial-and-temporal-data-explained.html</link>
			<guid isPermaLink="true">http://complexcity.org/blog//2014/06/02/weibo-spatial-and-temporal-data-explained.html</guid>
			<pubDate>2014-06-02T00:00:00+08:00</pubDate>
			<description>&lt;p&gt;The following post goes along with the article &lt;a href=&quot;/studies/&quot;&gt;Weibo spatial and temporal data&lt;/a&gt;. The visualization was built on two JavaScript libraries: &lt;a href=&quot;http://d3js.org&quot;&gt;D3.js&lt;/a&gt; for the bar chart and &lt;a href=&quot;http://mapbox.com&quot;&gt;Mapbox.js&lt;/a&gt; for the map. The purpose of this tutorial is to explain the technical side and hence give a practical example around these two libraries. It assumes you know a little about web development though: how to edit a web page and view it in your browser, how to include JavaScript on the page and the like.&lt;/p&gt;

&lt;h2 id=&quot;the_data&quot;&gt;The data&lt;/h2&gt;

&lt;p&gt;For the &lt;a href=&quot;/projects/&quot;&gt;Digital Eternity Project&lt;/a&gt;, we queried the Weibo API with a Python script using a tessellation of Shanghai made with 4 km diameter cells centered on 85 locations. Thus, we collected about 245,000 messages created between April 1 and April 9. These messages were stored into a SQLite database. Then, another Python script was in charge of counting the messages. The result is a JavaScript dictionary (or associative array) associating the number of messages at the 24 hours of the day to each of the 85 GPS coordinates:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;s1&#39;&gt;&amp;#39;31.254200, 121.532400&amp;#39;&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;88&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;37&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;19&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;12&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;9&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;11&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;35&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;47&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;103&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;74&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;71&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;73&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;87&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;70&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;54&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;80&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;71&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;101&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;117&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;152&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;168&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;180&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;141&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt;
  &lt;span class=&#39;err&#39;&gt;…&lt;/span&gt;
  &lt;span class=&#39;s1&#39;&gt;&amp;#39;31.308200, 121.511400&amp;#39;&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;261&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;96&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;47&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;36&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;12&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;23&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;76&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;114&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;150&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;226&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;196&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;251&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;263&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;294&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;224&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;303&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;311&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;332&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;350&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;338&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;325&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;303&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;345&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So, for example, the number of messages created in the cell centered in (31.254200, 121.532400) between 3 and 4 am is given by &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;31.254200, 121.532400&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This variable is stored in the external file weibo.js.&lt;/p&gt;

&lt;h2 id=&quot;the_code&quot;&gt;The code&lt;/h2&gt;

&lt;p&gt;The full code for the visualization can be found on &lt;a href=&quot;https://github.com/ComplexCity/weibo-qingmingjie&quot;&gt;GitHub&lt;/a&gt; but globally it looks like:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;html&#39;&gt;&lt;span class=&#39;cp&#39;&gt;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;charset=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt; &lt;span class=&#39;nt&#39;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Weibo messages during QingMing Jie&lt;span class=&#39;nt&#39;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
  
  &lt;span class=&#39;c&#39;&gt;&amp;lt;!-- prepare and load everything for Mapbox --&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;name=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;viewport&amp;quot;&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;content=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;initial-scale=1,maximum-scale=1,user-scalable=no&amp;quot;&lt;/span&gt; &lt;span class=&#39;nt&#39;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&#39;na&#39;&gt;src=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.js&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;link&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;href=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.css&amp;quot;&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;rel=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt; &lt;span class=&#39;nt&#39;&gt;/&amp;gt;&lt;/span&gt;

  &lt;span class=&#39;c&#39;&gt;&amp;lt;!-- the style --&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;style&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#barchart&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{}&lt;/span&gt;
  &lt;span class=&#39;c&#39;&gt;/* ... some CSS ... */&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;/style&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;

&lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;content&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;map&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;barchart&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;tip&amp;quot;&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;display:none&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;

&lt;span class=&#39;c&#39;&gt;&amp;lt;!-- load the data --&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&#39;na&#39;&gt;src=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;weibo.js&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;

&lt;span class=&#39;c&#39;&gt;&amp;lt;!-- load the d3.js library --&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&#39;na&#39;&gt;src=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;http://d3js.org/d3.v3.min.js&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;

&lt;span class=&#39;c&#39;&gt;&amp;lt;!-- the script --&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
&lt;span class=&#39;cm&#39;&gt;/* ... some JavaScript ... */&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;the_bar_chart_explained&quot;&gt;The bar chart explained&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&quot;http://d3js.org&quot;&gt;D3&lt;/a&gt; SVG (&lt;a href=&quot;http://www.w3.org/Graphics/SVG/&quot;&gt;Scalable Vector Graphics&lt;/a&gt;) bar chart is made of a &lt;em&gt;g&lt;/em&gt; element for the y axis, a &lt;em&gt;g&lt;/em&gt; element for the bars and a &lt;em&gt;text&lt;/em&gt; element for the title. The &lt;em&gt;g&lt;/em&gt; element of the bars contains itself 24 &lt;em&gt;g&lt;/em&gt; elements. Each of them contains a &lt;em&gt;rect&lt;/em&gt; for the actual bar and a &lt;em&gt;text&lt;/em&gt; for the hour in the x axis.&lt;/p&gt;
&lt;svg height=&#39;190&#39; width=&#39;400&#39;&gt;
	&lt;g height=&#39;100&#39; transform=&#39;translate(1,1)&#39; width=&#39;50&#39;&gt;
		&lt;rect height=&#39;106&#39; style=&#39;fill:white; stroke:#3182bd; stroke-width:1px;&#39; width=&#39;50&#39; x=&#39;0&#39; y=&#39;0&#39; /&gt;
		&lt;text style=&#39;fill:#3182bd;&#39; x=&#39;7&#39; y=&#39;50&#39;&gt;y axis&lt;/text&gt;
	&lt;/g&gt;
	&lt;g height=&#39;141&#39; transform=&#39;translate(54,1)&#39; width=&#39;345&#39;&gt;
		&lt;rect height=&#39;141&#39; style=&#39;fill:white; stroke:#3182bd; stroke-width:1px;&#39; width=&#39;345&#39; x=&#39;0&#39; y=&#39;0&#39; /&gt;
		&lt;g height=&#39;135&#39; transform=&#39;translate(3,3)&#39; width=&#39;46&#39;&gt;
			&lt;rect height=&#39;135&#39; style=&#39;fill:white; stroke:#3182bd; stroke-width:1px;&#39; width=&#39;46&#39; x=&#39;0&#39; y=&#39;0&#39; /&gt;
			&lt;rect height=&#39;99&#39; style=&#39;fill:white; stroke:red; stroke-width:1px;&#39; width=&#39;40&#39; x=&#39;3&#39; y=&#39;3&#39; /&gt;
			&lt;text style=&#39;fill:red;&#39; x=&#39;11&#39; y=&#39;50&#39;&gt;bar&lt;/text&gt;
			&lt;rect height=&#39;27&#39; style=&#39;fill:white; stroke:orange; stroke-width:1px;&#39; width=&#39;40&#39; x=&#39;3&#39; y=&#39;105&#39; /&gt;
			&lt;text style=&#39;fill:orange;&#39; x=&#39;6&#39; y=&#39;123&#39;&gt;x axis&lt;/text&gt;
		&lt;/g&gt;
		&lt;text style=&#39;fill:#ccc;&#39; x=&#39;60&#39; y=&#39;80&#39;&gt;x 24&lt;/text&gt;
	&lt;/g&gt;
	&lt;g height=&#39;45&#39; transform=&#39;translate(54,145)&#39; width=&#39;345&#39;&gt;
		&lt;rect height=&#39;40&#39; style=&#39;fill:white; stroke:orange; stroke-width:1px;&#39; width=&#39;345&#39; x=&#39;0&#39; y=&#39;0&#39; /&gt;
		&lt;text style=&#39;fill:orange;&#39; x=&#39;150&#39; y=&#39;20&#39;&gt;title&lt;/text&gt;
	&lt;/g&gt;
&lt;/svg&gt;
&lt;p&gt;Let’s focus now on the JavaScript part.&lt;/p&gt;

&lt;p&gt;First, we define some constants for the colors and sizes.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#4c5b68&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;barColorOn&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#a7b7b6&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;legendColor&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#404040&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;20&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;barsWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;55&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;chartWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barsWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
  
&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;xAxisHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;15&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;chartTitleHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;45&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;chartHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;xAxisHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;chartTitleHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Before we create the chart, we prepare the data we are going to use. We need to count the total number of messages for each hour of the day. To do so, we make a loop over the &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;/code&gt; variable to sum the number of every location for each hour. The results are stored in an array called &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgByHour&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
&lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;coord&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;++&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;coord&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We find the maximum value so that we can define the function to scale the values to the appropriate bar heights.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;countMax&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
&lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;++&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;countMax&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;countMax&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;scale&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;linear&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;domain&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;countMax&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can create the bar chart. The following block of code selects the &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#barchart&lt;/span&gt;&lt;/code&gt; on the page and appends an svg object to it of the size that we have set up.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;chart&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;div#barchart&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;svg&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;chartWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;height&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;chartHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;First, we create the y Axis. It uses almost the same scale function as the bars except that in the axis the values are oriented from top to bottom by default so we reverse the order for range. This axis is going to be oriented to the left with 5 ticks on it. As already told, the y axis is appended to the chart within a &lt;em&gt;g&lt;/em&gt; element.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;yAxis&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;svg&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;axis&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;scale&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;scale&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;linear&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;domain&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;countMax&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]))&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;orient&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;left&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;ticks&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;

&lt;span class=&#39;nx&#39;&gt;chart&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;class&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;y axis&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;transform&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;translate(45, 0)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;call&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;yAxis&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For the bars, we append a new &lt;em&gt;g&lt;/em&gt; element to the chart on the right of the y axis.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;bars&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;chart&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barsWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;transform&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;translate(&amp;quot;&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;, 0)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And we add the bars to this element:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;gEnter&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;bars&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;selectAll&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;data&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;enter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;().&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;g&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;transform&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;translate(&amp;quot;&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;, 0)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;height&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;xAxisHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This block of code creates the bars and associates each of them with a data set ( &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;data&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;/code&gt; ). For each value in &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;/code&gt;, a &lt;em&gt;g&lt;/em&gt; element is to be created. Note that the position of each &lt;em&gt;g&lt;/em&gt; is determined by a function so that its x position can depend on the index of the value in &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;/code&gt;. The &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;/code&gt; parameter of this function stands for the index in &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;/code&gt; and the &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;/code&gt; parameter stands for the value (that is to say &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;nbMsgsByHour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;As previously said, each of these 24 &lt;em&gt;g&lt;/em&gt; element in turn contains a &lt;em&gt;rect&lt;/em&gt; and a &lt;em&gt;text&lt;/em&gt;. So we add a &lt;em&gt;rect&lt;/em&gt; and a &lt;em&gt;text&lt;/em&gt; to these &lt;em&gt;g&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;nx&#39;&gt;gEnter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;rect&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;x&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;height&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;stroke&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;stroke-width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;

&lt;span class=&#39;nx&#39;&gt;gEnter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;x&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;xAxisHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;height&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;xAxisHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;legendColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;font-size&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;10px&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;text&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that the height (and the position) of the bar relies on the call of our &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;/code&gt; function with each value. The hour in the x axis is simply the index of the value.&lt;/p&gt;

&lt;p&gt;Lastly we have to add a title to our chart:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;nx&#39;&gt;chart&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;x&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;chartHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;13&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barsWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;legendColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;font-size&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;13px&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;font-weight&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;bold&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;text-align&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;text&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s2&#39;&gt;&amp;quot;Number of messages by hour of the day&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We are also want a tooltip to show up when one mouses over a bar to display the actual value. To do so, we are going to use the &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#tip&lt;/span&gt;&lt;/code&gt; of our HTML code and add two functions to show and hide the tooltip.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;showTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;count&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;top&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;left&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;#tip&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;text&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;count&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;top&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;top&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;px&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;left&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;left&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;s2&#39;&gt;&amp;quot;px&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;display&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;block&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;hideTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;#tip&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;text&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s2&#39;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;display&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;none&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We change the code for the bar &lt;em&gt;rect&lt;/em&gt; to handle the &lt;em&gt;mouseover&lt;/em&gt; and &lt;em&gt;mouseout&lt;/em&gt; events. To help the user know which bar is emphasized, we also change the color of the bar.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;nx&#39;&gt;gEnter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;rect&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;x&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;height&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;stroke&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;stroke-width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;on&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;mouseover&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;this&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;transition&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;duration&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOn&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;showTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;13&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;on&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;mouseout&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;this&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;transition&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;duration&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;500&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;hideTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;();&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And check the resulting bar chart in &lt;a href=&quot;/studies/&quot;&gt;Weibo spatial and temporal data&lt;/a&gt;!&lt;/p&gt;

&lt;h2 id=&quot;the_map_explained&quot;&gt;The map explained&lt;/h2&gt;

&lt;p&gt;First, we need to initialize the &lt;a href=&quot;http://mapbox.com&quot;&gt;Mapbox&lt;/a&gt; map into the &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#map&lt;/span&gt;&lt;/code&gt; element (change &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;USER.MAP&amp;#39;&lt;/span&gt;&lt;/code&gt; to your own map reference). The map is centered on Shanghai coordinates with a zoom of 11.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;L&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;mapbox&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;map&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;USER.MAP&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;setView&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;mf&#39;&gt;31.2542&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;121.4904&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;11&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now that we have a map on the web page, let’s customize it with some data. Just as for the bar chart, we need to prepare the data. The next block of code stores into a &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;/code&gt; array the list of circles to be displayed on the map for each hour. And at the end ( &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;/code&gt; ), another list of circles represents the total number of messages by location regardless of the time of the day. To get these numbers, we simply sum the numbers of messages of every hours for each location.&lt;/p&gt;

&lt;p&gt;Each circle is a &lt;a href=&quot;https://www.mapbox.com/mapbox.js/api/v1.6.3/l-circle/&quot;&gt;L.Circle&lt;/a&gt; object centered on one of our 85 locations with a radius of 2000 m. The color used to fill each circle depends on the number of messages. Therefore, we use a function to determine the color depending of the given value. Actually, we are going to make two functions to implement different scales for the number of messages by hour or in total: getColor will serve for the hourly values and getGlobalColor for the total values.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;#f0f9e9&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#ccecc7&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#a8deb7&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#7ecdc4&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#4aa2c8&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;#1d67a9&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;getGlobalColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;800&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1600&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;4500&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;6400&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;9600&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;getColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;70&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;140&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;250&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;400&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;value&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;600&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;4&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;colors&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt;
 &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt;
 &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[],&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[]];&lt;/span&gt;

&lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;coord&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;coord&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;split&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s2&#39;&gt;&amp;quot;, &amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;parseFloat&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]);&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;parseFloat&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]);&lt;/span&gt;
  &lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;count&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;++&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;count&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;coord&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;];&lt;/span&gt;
    &lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circle_options&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
      &lt;span class=&#39;nx&#39;&gt;stroke&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;false&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
      &lt;span class=&#39;nx&#39;&gt;fillColor&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;getColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;weibo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;coord&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]),&lt;/span&gt;
      &lt;span class=&#39;nx&#39;&gt;fillOpacity&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;0.5&lt;/span&gt;
    &lt;span class=&#39;p&#39;&gt;};&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;].&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;push&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;L&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;circle&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2000&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circle_options&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
  &lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circle_options&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;stroke&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;kc&#39;&gt;false&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;fillColor&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;getGlobalColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;count&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;fillOpacity&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;0.6&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;};&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;].&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;push&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;L&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;circle&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;latlng&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]],&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2000&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circle_options&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, we need to be able to add (and remove) circles to (from) the map. The purpose of the following functions is to add or remove all the circles for a given hour, that is to say the list of circles at &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;].&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;length&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;++&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;].&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;addTo&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;currentLayer&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;].&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;length&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;++&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;circles&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;j&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]);&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default, we want the map to show the total number of messages for each location.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;span class=&#39;kd&#39;&gt;var&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;currentLayer&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The variable &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;currentLayer&lt;/span&gt;&lt;/code&gt; is going to help us keep track of the index of the list of circles currently displayed.&lt;/p&gt;

&lt;p&gt;Now, we simply have to to modify the handlers of the &lt;em&gt;mouseover&lt;/em&gt; and &lt;em&gt;mouseout&lt;/em&gt; events in the bar chart to display the proper list of circles. When the mouse passes over a bar we want to remove the list of circles currently displayed ( &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;currentLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;/code&gt; ) and to show the list of circles corresponding to the selected hour ( &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;&lt;/code&gt; ). On the contrary, when the mouse moves out of a bar, we want to display the default list of circles with the total numbers of messages.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;nx&#39;&gt;gEnter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;rect&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;x&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;y&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;attr&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;height&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;stroke&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;s1&#39;&gt;&amp;#39;white&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;stroke-width&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;on&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;mouseover&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;this&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;transition&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;duration&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOn&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;showTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;13&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;currentLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;		&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;on&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;mouseout&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;this&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;transition&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;duration&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;500&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;hideTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;();&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, we need to add a legend to the map. As we have two scales of values, we need two different legends and be able to switch between them depending on what is displayed on the map.&lt;/p&gt;

&lt;p&gt;Each legend will consist in a &lt;em&gt;div&lt;/em&gt;: &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#legend&lt;/span&gt;&lt;/code&gt; for the total values and &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#layerLegend&lt;/span&gt;&lt;/code&gt; for the hourly values. Those &lt;em&gt;div&lt;/em&gt; are added in the HTML along with the map container.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;html&#39;&gt;&lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;content&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;legend&amp;quot;&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;display:none&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;strong&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;class=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;legend-title&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;Number of messages&lt;span class=&#39;nt&#39;&gt;&amp;lt;/strong&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;class=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;legend clearfix&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#f0f9e9&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#ccecc7&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#a8deb7&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#7ecdc4&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#4aa2c8&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#1d67a9&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;class=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;legend cleafix&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label1&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;≤ 800&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label2&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 800&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label3&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 1600&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label4&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 4500&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label5&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 6400&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label6&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 9600&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;layerLegend&amp;quot;&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;display:none&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;strong&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;class=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;legend-title&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;Number of messages&lt;span class=&#39;nt&#39;&gt;&amp;lt;/strong&amp;gt;&lt;/span&gt;
   &lt;span class=&#39;nt&#39;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;class=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;legend clearfix&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#f0f9e9&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#ccecc7&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#a8deb7&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#7ecdc4&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#4aa2c8&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;background:#1d67a9&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/span&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;nav&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;class=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;legend cleafix&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label1&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;≤ 70&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label2&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 70&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label3&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 140&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label4&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 250&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label5&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 400&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
      &lt;span class=&#39;nt&#39;&gt;&amp;lt;label&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;label6&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;&amp;gt; 600&lt;span class=&#39;nt&#39;&gt;&amp;lt;/label&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;/nav&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;map&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;barchart&amp;quot;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#39;nt&#39;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;id=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;tip&amp;quot;&lt;/span&gt; &lt;span class=&#39;na&#39;&gt;style=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;display:none&amp;#39;&lt;/span&gt;&lt;span class=&#39;nt&#39;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
  &lt;span class=&#39;nt&#39;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&#39;nt&#39;&gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default, naturally we will display the legend of &lt;code class=&#39;highlight&#39;&gt;&lt;span class=&#39;nt&#39;&gt;div&lt;/span&gt;&lt;span class=&#39;nf&#39;&gt;#legend&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;legendControl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;addLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;document&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;getElementById&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;legend&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;innerHTML&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We now add two functions to switch the legends.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;showLayerLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;legendControl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;removeLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;document&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;getElementById&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;legend&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;innerHTML&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;legendControl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;addLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;document&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;getElementById&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;layerLegend&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;innerHTML&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;

&lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;hideLayerLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;legendControl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;removeLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;document&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;getElementById&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;layerLegend&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;innerHTML&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
  &lt;span class=&#39;nx&#39;&gt;map&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;legendControl&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;addLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;document&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;getElementById&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;legend&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;innerHTML&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
&lt;span class=&#39;p&#39;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And we modify the handlers of the &lt;em&gt;mouseover&lt;/em&gt; and &lt;em&gt;mouseout&lt;/em&gt; events in the bar chart to effectively switch the legends.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;on&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;mouseover&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;{&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;this&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;transition&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;duration&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;100&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOn&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;showTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;barMaxHeight&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barHeight&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;yAxisWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barWidth&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;13&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;));&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;currentLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;showLayerLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;();&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;})&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;on&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;mouseout&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;kd&#39;&gt;function&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;d&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;){&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;d3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;select&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;this&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;).&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;transition&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;duration&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;500&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
      &lt;span class=&#39;p&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;style&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s1&#39;&gt;&amp;#39;fill&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nx&#39;&gt;barColorOut&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;hideTip&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;();&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;removeLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nx&#39;&gt;i&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;addLayer&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;24&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;);&lt;/span&gt;
    &lt;span class=&#39;nx&#39;&gt;hideLayerLegend&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;();&lt;/span&gt;	&lt;span class=&#39;c1&#39;&gt;// &amp;lt;&amp;lt;-&lt;/span&gt;
  &lt;span class=&#39;p&#39;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And we’re done! Check the full code on &lt;a href=&quot;https://github.com/ComplexCity/weibo-qingmingjie&quot;&gt;GitHub&lt;/a&gt; and the working example in the article &lt;a href=&quot;/studies/&quot;&gt;Weibo spatial and temporal data&lt;/a&gt;.&lt;/p&gt;</description>
		</item>
	
	

		<item>
			<title>Youth Planners&#39; Innovation Forum</title>
			<link>http://complexcity.org/blog//2014/05/26/youth-planners-inovation-forum.html</link>
			<guid isPermaLink="true">http://complexcity.org/blog//2014/05/26/youth-planners-inovation-forum.html</guid>
			<pubDate>2014-05-26T00:00:00+08:00</pubDate>
			<description>&lt;p&gt;On May 17, 2014, I attended the Youth Planners’ Innovation Forum. The forum was held by China’s most prestigious planning school — Tongji University — as a brainstorm with inspiring lectures on various research fields on urban studies. The forum was divided into 4 major symposiums, including “区域发展与总体规划” (regional development and master planning), “城市更新与历史保护” (urban renewal and historic preservation), “乡村规划与城乡统筹” (rural planning and urban-rural integration), “信息技术与规划创新” (information technology and planning innovation). The lectures and discussions afterwards generated some very visionary ideas and they are undoubtedly beneficial to provide solutions for China’s urban predicaments at present.&lt;/p&gt;

&lt;p&gt;Professor Zhao Min, specialized in regional development and urbanization, mentioned that it is important to differentiate migrant workers from migrants when conducting research on public policy for coordinating rural and urban development. Migrant workers mostly seek work in a city while migrants are more concerned with being involved in urban life and social inclusion. This has brought a question to policy-makers: is it really necessary to provide low-rental housing for migrant workers with the government’s investments? Since their interest is not about being urban dwellers, but only to make as much profits as they can before they leave the city eventually. On the contrary, to migrants, who really intend to be members of urban society, we should not just offer them urban identity such as hukou, but also make them feel social inclusion by organizing community participation, etc. On that matter, Li Zhigang, a Professor from Sun Yat-sen University specialized in migrants and affordable housing, showed that, valuing the role of middle class when proposing planning mechanism for mixed-living model may be beneficial for a more harmonious society.&lt;/p&gt;

&lt;p&gt;Another opinion being discussed during the forum is in-situ urbanization, which provides a possible solution for easing the burden of social inclusion in large cities. In-situ urbanization advocates investment preference to small and medium cities to attract migrants to stay and work there instead of pouring into large cities. With China’s urbanization going deeper, the small towns that had become important foci for industrial development grew to become substantial urban centers with concentrations of industry and were reclassified as cities, a process known as in-situ urbanization. It has caused significant structural and physical changes in vast rural areas, and has also resulted in an increasingly blurred distinction between urban and rural settlements. To prevent further marginalization of rural areas, it is crucial to enhance the attractiveness of the areas to keep the potential migrant workers instead of forcing them to move to larger cities for a better life. In-situ urbanization can effectively make rural areas more competitive, and promote local infrastructure and social welfare development.&lt;/p&gt;

&lt;p&gt;When I was on subway to Tongji University for the forum, it is not quite convenient to get there from my university (had to take at least 3 different lines). So is it possible to consider building a faster transportation system connecting all the universities in Shanghai without stopping at other places? Not just for my sake, but for promoting the exchange of ideas for all the scholars and students. Maybe we can name the system “shuttle” since we hope it works just like that? The reason to connect universities is to promote the agglomeration of intelligence, since universities are often served as the city’s or even country’s intellectual pool and they can boost local development and innovation (as proved by Silicon Valley in California, USA and Zhongguancun in Beijing, China). Construction for such system will inevitably cost the government’s revenue, however, in the long run, the system, which is 100% students/ faculties oriented, will fruit the city.&lt;/p&gt;

&lt;h3 id=&quot;bibliography&quot;&gt;Bibliography&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;Zhu, Yu. Qi, Xinhua. Shao, Huaiyou. He, Kaijing. ”&lt;a href=&quot;http://www.ciesin.columbia.edu/repository/pern/papers/urban_pde_zhu_etal.pdf&quot;&gt;The Evolution of China’s In-situ Urbanization And Its Planning And Environmental Implications: Case Studies From Quanzhou Municipality&lt;/a&gt;”. 2009 Urban Population-Environment Dynamics in the Developing World: Case Studies and Lessons learned. Paris: Committee for International Cooperation in National Research in Demography (CICRED) pp. 213-245.&lt;/li&gt;

&lt;li&gt;Yusuf, Shahid. Saich, Tony. ”&lt;a href=&quot;http://link.springer.com/article/10.1007/s11366-009-9053-y&quot;&gt;China Urbanizes: Consequences, Strategies, and Policies&lt;/a&gt;”, Journal of Chinese Political Science, Volume 14, Issue 2, (June 2009): pp. 219-220.&lt;/li&gt;
&lt;/ol&gt;</description>
		</item>
	
	

		<item>
			<title>Hukou system for college graduates</title>
			<link>http://complexcity.org/blog//2014/05/19/hukou-system-for-college-graduates.html</link>
			<guid isPermaLink="true">http://complexcity.org/blog//2014/05/19/hukou-system-for-college-graduates.html</guid>
			<pubDate>2014-05-19T00:00:00+08:00</pubDate>
			<description>&lt;p&gt;In China, each person has a household registration, also known as hukou (户口) in either a rural area or an urban area, and cannot change it without the permission of the receiving jurisdiction. David Dollar, World Bank Country, explains “Hukou system kept rural-urban migration below what it otherwise would have been, and contributed to the development of one of the largest rural-urban income divides in the world.” In short, it is much like a green card or “internal passport” that provides its bearer access to public service, such as health care, education, etc. But, as stated by China Labour Bulletin, the downside of this system is that “Outside their home province, migrant workers face numerous institutional hurdles compared to local residents, such as tougher standards for entrance into universities, requirements for residential permits, limited access to health and social services, including schools for their children and, in some cases, restrictions on purchase of homes and vehicles.”&lt;/p&gt;

&lt;p&gt;To achieve the “Chinese dream”, some researchers point that it is important to give all migrants an urban hukou within the next 15 years. We believe the relaxation of the hukou system should benefit for all, but also considering it can only be done with several steps and granting a hukou to college graduates as a major step. In western world, many countries and businesses foresee the potential of intellectuals as catalyst for local economic boom, and advocate relevant policies to attract college graduates, regardless of their origin. As President Obama emphasized this in his State of Union address:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Let’s stop expelling talented, responsible young people who could be staffing our research labs or starting a new business, who could be further enriching this nation.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Fairly speaking, China’s policy makers already see the importance of enhancing the mobility of highly educated people, and are taking some actions as offering land or taxes preferential policy. However, in big cities, the hukou system still repulses graduates who come from other localities. Kam Wing Chan, professor of geography at University of Washington, former consultant of urbanization and urban migration projects for the United Nations and the World Bank, writes:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Each year, the numbers of migrant graduates who gain a local hukou in large cities like Shanghai and Beijing is very small, ranging from a few hundred to perhaps one or two thousand out of hundreds of thousands of college-educated migrants in each city.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As mentioned before, it is not convenient for graduates transferring their hukous among Chinese cities, especially when considering the ever-growing trend of frequent migration for work of young people. Today China’s higher education system provides services including assisting students transferring their hukou during graduation period. However, if a student does not obtain a job offer when he graduates, his/her hukou will be moved to local College Graduates Employment Guidance Center (高校毕业生就业指导中心) automatically. Only after he/she gets a job, his/her hukou can be transferred to the workplace. If a student intends to go abroad and move the hukou back to his/her hometown, there will be a complicated process to go through. Some local authorities ask college graduates to prove their “unmarried” status as a prerequisite to move their hukou back under the reason of “Children join their parents” (外地子女投靠父母), which requires students to go back to the cities where they studied for the proof of their marital status. It is an expensive and time-consuming process since a large part of students move to other cities far away after graduation. The regulation also changes numerous students who left home for study to a “floating population” (外来人口) and deprives them of their full rights to access public services before they successfully move their hukou back.&lt;/p&gt;

&lt;p&gt;Again, the foreseeable solution for this issue could be the relaxation of the hukou system for college graduates, especially gradually abolishing the requirement for their “unmarried” status. It may also be helpful to build an on-line database about personal residential information for further verification instead of demanding students to commute among different cities in person for the hukou-transferring paperwork.&lt;/p&gt;

&lt;h3 id=&quot;bibliography&quot;&gt;Bibliography&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;Hukou system. &lt;a href=&quot;http://en.wikipedia.org/wiki/hukou_system&quot;&gt;Wikipedia&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;Dollar, David. “Poverty, inequality and social disparities during China’s economic reform” &lt;a href=&quot;http://econ.worldbank.org/external/default/main?pagePK=64165259&amp;theSitePK=477872&amp;piPK=64165421&amp;menuPK=64166093&amp;entityID=000016406_20070613095018&quot; title=&quot;paper on The World Bank&quot;&gt;The World Bank&lt;/a&gt;. June 6, 2007.&lt;/li&gt;

&lt;li&gt;Employment discrimination in China. &lt;a href=&quot;http://www.clb.org.hk/en/view-resource-centre-content/110167#hukou&quot;&gt;China Labour Bulletin&lt;/a&gt;.&lt;/li&gt;

&lt;li&gt;Chan, Kam Wing. “A road map for reforming China’s hukou system”. &lt;a href=&quot;https://www.chinadialogue.net/article/show/single/en/6432-A-road-map-for-reforming-China-s-hukou-system&quot; title=&quot;article on ChinaDialogue.net&quot;&gt;ChinaDialogue.net&lt;/a&gt;. October 22, 2013.&lt;/li&gt;

&lt;li&gt;“新政发力促进优秀人才来无锡就业创业”. &lt;a href=&quot;http://jsnews.jschina.com.cn/system/2014/04/29/020873979.shtml&quot; title=&quot;article on www.jschina.com.cn&quot;&gt;中国江苏网&lt;/a&gt;. April 29, 2014.&lt;/li&gt;

&lt;li&gt;&lt;a href=&quot;http://www.npc.gov.cn/wxzl/gongbao/2000-12/10/content_5004332.htm&quot;&gt;《中华人民共和国户口登记条例》&lt;/a&gt; (Regulations on Household Registration of the People’s Republic of China)&lt;/li&gt;
&lt;/ol&gt;</description>
		</item>
	
	

		<item>
			<title>Identity of Chinese cities</title>
			<link>http://complexcity.org/blog//china/cities/2014/05/12/identity-of-chinese-cities.html</link>
			<guid isPermaLink="true">http://complexcity.org/blog//china/cities/2014/05/12/identity-of-chinese-cities.html</guid>
			<pubDate>2014-05-12T00:00:00+08:00</pubDate>
			<description>&lt;p&gt;The outstanding work of &lt;em&gt;The Spirit of Cities&lt;/em&gt; [&lt;a href=&quot;#1&quot;&gt;1&lt;/a&gt;] by Bell and de-Shalit gives a very interesting point of view at how some cities are unique for their citizens. As a matter of fact more and more Chinese citizens feel detached from their cities. They find it difficult to recognize their city identity whereas identity might be a key factor to integrate millions of people in a short time to new urban area without them feeling they do not belong here or that they live just-another-lambda city.&lt;/p&gt;

&lt;p&gt;Several obstacles stand in the way of Chinese planners we would like to emphasize: wealth gap, integration of migrant, worldwide disinterest for citizenship responsibility, city official planning expertise among the stronger ones.&lt;/p&gt;

&lt;p&gt;The authors argue that it is a key factor for promoting urban identity that the city does not have a huge gap between rich and poor or between ethnic and racial groups. Argument is that if people live separate lives and strongly dislike one another, they will find it difficult to share a common interest. Given the huge class/social gap in Chinese cities (according to the numerous researches published on World Bank report [&lt;a href=&quot;#2&quot;&gt;2&lt;/a&gt;], Forbes [&lt;a href=&quot;#3&quot;&gt;3&lt;/a&gt;], NY Times [&lt;a href=&quot;#4&quot;&gt;4&lt;/a&gt;], NBC News [&lt;a href=&quot;#5&quot;&gt;5&lt;/a&gt;], it will be very hard for Chinese cities to promote urban identities effectively without proper integration of different class of population.&lt;/p&gt;

&lt;p&gt;The gap is especially true when speaking about the severe living status of migrant workers. In recent decades, Chinese migrant workers came to cities for jobs taking benefit of the construction boom but as Isabel Hilton stated for ChinaDialogue [&lt;a href=&quot;#6&quot;&gt;6&lt;/a&gt;]:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;With no right of abode they are locked into the status of a disadvantaged underclass, allowed to work in cities but not to enjoy the right of residence that would give them and their families access to health care or public education. .&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Consequently, how do we expect them to contribute to create a strong urban identity while they are struggling to meet the basic needs of life? According to the research by &lt;a href=&quot;https://www.chinadialogue.net/&quot;&gt;ChinaDialogue&lt;/a&gt;, prejudice against migrant workers plagues urban society. Marginalization has left many migrants disenchanted. A 52-year-old migrant worker in Beijing expressed trenchantly what people think [&lt;a href=&quot;#7&quot;&gt;7&lt;/a&gt;]:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;No matter how long we live and work here, Beijing could never be our home&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The deterioration of urban identity is closely related to issues of social justice since it is difficult for the marginalized to feel they belong somewhere. But if such a climate makes it difficult for a city identity to emerge, contribute to the emergence through integration of migrant culture into design, planning, and city life is also a solution to give citizens something they can all relate to regardless of their income levels, cultures, age, etc. City might be the good place to embody this craver for harmony [&lt;a href=&quot;#8&quot;&gt;8&lt;/a&gt;].&lt;/p&gt;

&lt;p&gt;Another factor mentioned by Bell and de-Shalit is that the residents have a strong motivation to struggle to keep their identity when the urban identity is threatened by outside forces. Such as the people of Hong Kong fight to maintain their capitalist way of life as opposed to mainland China [&lt;a href=&quot;#9&quot;&gt;9&lt;/a&gt;]. Unfortunately, public participation and conceptions such as “fighting for the rights” are not deeply rooted in Chinese people’s minds [&lt;a href=&quot;#10&quot;&gt;10&lt;/a&gt;]. Many citizens don’t take fighting for the urban identity as their obligation. Instead, they see it more likely as a “government business/affair” even though regulation in China ask for citizens approval.&lt;/p&gt;

&lt;p&gt;According to &lt;em&gt;Urban and Rural Planning Law of the People’s Republic of China&lt;/em&gt;, Article 26:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Before filing an urban or rural planning for examination and approval, the organ establishing it shall announce the draft of the planning and collect opinions from experts and the general public by way of argumentation, hearing or other. The draft shall be announced for at least 30 days.（《城乡规划法》第二十六条：城乡规划报送审批前，组织编制机关应当依法将城乡规划草案予以公告，并采取论证会、听证会或者其他方式征求专家和公众的意见。公告的时间不得少于三十日。）[&lt;a href=&quot;#11&quot;&gt;11&lt;/a&gt;].&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The fact citizens do not feel involved in their city life is not specific to China. Here technology have a strong role to play here by making citizen experience their city present and future. Smart city and smart government are beginning to answer this need. It is our duty to design effective ways to stimulate people’s passion for public participation on reviving or promoting urban identity.&lt;/p&gt;

&lt;p&gt;The book also points out that it is essential for cities to have great urban planners to enact transformative plans that help to realize a common public urban identity. Environment contributes most to urban identity since they provide a space to experiment and live in to both residents and tourists. However, urban planning in China became a &lt;em&gt;manufacturing process&lt;/em&gt; which creates numerous soulless and homogeneous cities. Local governments leave the planning jobs to design companies or schools, and most of them merely take it as an opportunity to make profits instead of an invaluable chance to revive urban identity. Therefore, urban planning in China often turns to drawing grand blueprints to meet local officials’ ideas.&lt;/p&gt;

&lt;p&gt;What makes it worse is, since most officials are not well-trained with professional knowledge of planning or urban studies, many of their &lt;em&gt;visions&lt;/em&gt; are merely impacted by the image conveyed by the media of what &lt;em&gt;future cities&lt;/em&gt; should look like. As a result, we see massive imitation of used planning models in many Chinese cities [&lt;a href=&quot;#12&quot;&gt;12&lt;/a&gt;], especially in new-built areas, such as car-oriented big streets, oversized city halls, etc. But to be fair, China’s urbanization face a unique situation. Many cities are preparing themselves to welcome millions of people in the next 10 years or so and this situation is unique in the world. Therefore time is an issue and it is pretty hard to foresee what society needs will be. To keep or develop an identity based on history and culture might not be the top priority even if it guarantees social stability in the future to connect to the past and gives everyone a reason to be proud of living somewhere.&lt;/p&gt;

&lt;p&gt;CEOs for Cities [&lt;a href=&quot;#13&quot;&gt;13&lt;/a&gt;] argues that:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Unique characteristics of place may be the only truly defensible source of competitive advantage for regions.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If Chinese cities are willing to achieve their ambitions and be highly competitive and attractive in the 21st century, it is essential to keep their own unique characteristics, engage people’s emotions and bring people a new whole experience about the city they live and work in by reviving urban identity. After all, the only way to mark the city in the trend of globalization is to effectively nourish and promote the particularity of city.&lt;/p&gt;

&lt;h2 id=&quot;bibliography&quot;&gt;Bibliography&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a name=&#39;1&#39; /&gt;Bell, Daniel A., and Avner De-Shalit. &lt;em&gt;The spirit of cities: Why the identity of a city matters in a global age&lt;/em&gt;. Princeton University Press, 2011. (see it on &lt;a href=&quot;http://www.goodreads.com/book/show/11452166-the-spirit-of-cities&quot; title=&quot;book on GoodReads&quot;&gt;GoodReads&lt;/a&gt;)&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;2&#39; /&gt;Dollar, David. “Poverty, inequality and social disparities during China’s economic reform” &lt;a href=&quot;http://econ.worldbank.org/external/default/main?pagePK=64165259&amp;theSitePK=477872&amp;piPK=64165421&amp;menuPK=64166093&amp;entityID=000016406_20070613095018&quot; title=&quot;paper on The World Bank&quot;&gt;The World Bank&lt;/a&gt;. June 6, 2007.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;3&#39; /&gt;Rapoza, Kenneth. “The China Miracle: A Rising Wealth Gap”. &lt;a href=&quot;http://www.forbes.com/sites/kenrapoza/2013/01/20/the-china-miracle-a-rising-wealth-gap/&quot; title=&quot;article on Forbes&quot;&gt;Forbes&lt;/a&gt;. January 20, 2013.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;4&#39; /&gt;Wong, Edward. “Survey in China Shows a Wide Gap in Income”. &lt;a href=&quot;http://www.nytimes.com/2013/07/20/world/asia/survey-in-china-shows-wide-income-gap.html&quot; title=&quot;article on The New York Times&quot;&gt;The New York Times&lt;/a&gt;. July 19, 2013.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;5&#39; /&gt;Schoen, John W. “China’s wealth gap strains social fabric”. &lt;a href=&quot;http://www.nbcnews.com/id/39546204/ns/business-world_business/t/chinas-wealth-gap-strains-social-fabric/&quot; title=&quot;article on NBC News&quot;&gt;NBC News&lt;/a&gt;. October 20, 2010.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;6&#39; /&gt;Hilton, Isabel. “China’s Urban Dilemma”. &lt;a href=&quot;https://www.chinadialogue.net/article/show/single/en/6459-China-s-urban-dilemma&quot; title=&quot;article on ChinaDialogue.net&quot;&gt;ChinaDialogue.net&lt;/a&gt;. November 11, 2013.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;7&#39; /&gt;Lin, Luna. “Chinese migrants struggle to find urban dream”. &lt;a href=&quot;https://www.chinadialogue.net/article/show/single/en/6426-Chinese-migrants-struggle-to-find-urban-dream&quot; title=&quot;article on ChinaDialogue.net&quot;&gt;ChinaDialogue.net&lt;/a&gt;. October 18, 2013.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;8&#39; /&gt;Barber, Benjamin R. “If mayors ruled the world.” &lt;em&gt;Why cities can and should govern globally and how they already do&lt;/em&gt;. Yale University Press, 2013. (see it on &lt;a href=&quot;http://www.amazon.fr/Mayors-Ruled-World-Barber-Benjamin-ebook/dp/B00FOR56YY/ref=sr_1_1?s=digital-text&amp;amp;ie=UTF8&amp;amp;qid=1401093542&amp;amp;sr=1-1&amp;amp;keywords=if+mayor+ruled+the+world&quot; title=&quot;book on Amazon&quot;&gt;Amazon&lt;/a&gt;)&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;9&#39; /&gt;Lipin, Michael. “Honk Kong Anti-Mainlander Protest Highlights Frustration With Visitor Influx”. &lt;a href=&quot;http://www.voanews.com/content/hong-kong-anti-mainlander-protest-highlights-frustration-with-visitor-influx/1862703.html&quot; title=&quot;article on Voice of America&quot;&gt;Voice of America&lt;/a&gt;.March 2, 2014.&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;10&#39; /&gt;Yi, Li. &lt;em&gt;Public Participation Issues in Preservation Planning: Practices of Chinese Historic District.&lt;/em&gt; (Masters Thesis). University of Pennsylvania, Philadelphia, PA, 2012. (see it on &lt;a href=&quot;http://repository.upenn.edu/hp_theses/193/&quot; title=&quot;paper on University of Pennsylvania ScholarlyCommons&quot;&gt;University of Pennsylvania ScholarlyCommons&lt;/a&gt;)&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;11&#39; /&gt;&lt;a href=&quot;http://wenku.baidu.com/link?url=lxmciTjBn01dCViZ2jWXhSKzFWkcUUsLGctpNuRghDuum5l60HXEam22VvfjCgDfrqziFht6n27p87T_4ydtn6fSOqC1NjEqhHhYkWbnv-m&quot; title=&quot;《中华人民共和国城乡规划法》&quot;&gt;中华人民共和国城乡规划法&lt;/a&gt; (Urban and Rural Planning Law of the People’s Republic of China)&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;12&#39; /&gt;Xu, Jiang and Anthony G.O. Yeh., “City Repositioning and Competitiveness Building in Regional Development: New Development Strategies in Guangzhou, China.” &lt;em&gt;International Journal of Urban and Regional Research&lt;/em&gt;, 29 (2005): 283–308. doi: 10.1111/j.1468-2427.2005.00585.x (see it on &lt;a href=&quot;http://onlinelibrary.wiley.com/doi/10.1111/j.1468-2427.2005.00585.x/abstract&quot; title=&quot;paper on Wiley Online Library&quot;&gt;Wiley Online Library&lt;/a&gt;)&lt;/li&gt;

&lt;li&gt;&lt;a name=&#39;13&#39; /&gt;&lt;a href=&quot;http://www.ceosforcities.org/city-vitals&quot; title=&quot;CEOs for Cities&quot;&gt;CEOs for Cities&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Photo: Chinese workers by Complexcity Lab, licensed under &lt;a href=&quot;https://creativecommons.org/licenses/by-nc-nd/2.0/&quot;&gt;CC BY-NC-ND 2.0&lt;/a&gt;&lt;/p&gt;</description>
		</item>
	
	
	</channel>
</rss>
